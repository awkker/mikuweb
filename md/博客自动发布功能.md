# åšå®¢è‡ªåŠ¨å‘å¸ƒåŠŸèƒ½

> å†™å®Œæ–‡ç« ï¼Œä¸€é”®å‘å¸ƒåˆ°åšå®¢é¡µé¢

## åŠŸèƒ½æ¦‚è¿°

åœ¨ç®¡ç†å‘˜åå°å†™å®Œæ–‡ç« åï¼Œç‚¹å‡»å‘å¸ƒæŒ‰é’®ï¼Œæ–‡ç« ä¼šï¼š
1. ä¿å­˜åˆ°æ•°æ®åº“
2. ç”Ÿæˆ Markdown æ–‡ä»¶åˆ° `comments/md/` ç›®å½•
3. è‡ªåŠ¨æ˜¾ç¤ºåœ¨åšå®¢é¡µé¢ï¼ˆåˆ·æ–°å³å¯çœ‹åˆ°ï¼‰

---

## æ–‡ä»¶ç»“æ„

```
mikuweb/
â”œâ”€â”€ comments/
â”‚   â”œâ”€â”€ main.go              # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ data.db              # SQLite æ•°æ®åº“
â”‚   â””â”€â”€ md/                  # ğŸ“ æ–‡ç«  Markdown æ–‡ä»¶å­˜æ”¾ç›®å½•
â”‚       â””â”€â”€ 1-æ–‡ç« æ ‡é¢˜.md
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ html/
â”‚   â”‚   â”œâ”€â”€ blog.html        # åšå®¢é¡µé¢ï¼ˆæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ï¼‰
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â””â”€â”€ write.html   # ç®¡ç†å‘˜å†™ä½œé¡µé¢
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ write.js         # å†™ä½œé¡µé¢é€»è¾‘
â”‚       â”œâ”€â”€ blog-layout.js   # åšå®¢å±•å¼€é˜…è¯»é€»è¾‘
â”‚       â””â”€â”€ blog-posts.js    # ğŸ†• åŠ¨æ€åŠ è½½æ–‡ç« åˆ—è¡¨
```

---

## ä½¿ç”¨æµç¨‹

### 1ï¸âƒ£ å¯åŠ¨åç«¯æœåŠ¡

```bash
cd comments
go run main.go
# æœåŠ¡å¯åŠ¨: http://localhost:8080
```

### 2ï¸âƒ£ ç™»å½•ç®¡ç†å‘˜åå°

1. æ‰“å¼€åšå®¢é¡µé¢ï¼Œç‚¹å‡»å¤´åƒç™»å½•
2. è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼ˆé»˜è®¤ `123456`ï¼‰

### 3ï¸âƒ£ å†™ä½œå¹¶å‘å¸ƒ

1. è®¿é—® `/static/html/admin/write.html`
2. å¡«å†™ï¼š
   - **æ ‡é¢˜**ï¼ˆå¿…å¡«ï¼‰
   - **æ‘˜è¦**ï¼ˆå¯é€‰ï¼Œä¸å¡«ä¼šè‡ªåŠ¨æˆªå–æ­£æ–‡å‰ 50 å­—ï¼‰
   - **å°é¢å›¾ URL**ï¼ˆå¯é€‰ï¼Œä¸å¡«ä¼šéšæœºåˆ†é…ï¼‰
   - **æ­£æ–‡**ï¼ˆMarkdown æ ¼å¼ï¼‰
3. ç‚¹å‡»å‘å¸ƒæŒ‰é’® âœˆï¸

### 4ï¸âƒ£ æŸ¥çœ‹å‘å¸ƒç»“æœ

1. åˆ·æ–° `/static/html/blog.html`
2. æ–°æ–‡ç« ä¼šæ˜¾ç¤ºåœ¨æœ€é¡¶éƒ¨

---

## æŠ€æœ¯å®ç°

### åç«¯ (Go)

```go
// Post ç»“æ„ä½“
type Post struct {
    ID        uint      `json:"id"`
    Title     string    `json:"title"`
    Summary   string    `json:"summary"`
    Cover     string    `json:"cover"`     // å°é¢å›¾ URL
    Content   string    `json:"content"`
    Tags      string    `json:"tags"`
    CreatedAt time.Time `json:"created_at"`
}

// å‘å¸ƒæ–‡ç« æ¥å£
admin.POST("/posts", func(c *gin.Context) {
    // 1. è§£æ JSON
    // 2. ä¿å­˜åˆ°æ•°æ®åº“
    // 3. ç”Ÿæˆ MD æ–‡ä»¶
    saveToMDFile(input)
    // 4. è¿”å›æˆåŠŸ
})
```

### å‰ç«¯ - å†™ä½œé¡µé¢ (write.js)

```javascript
async function publish() {
    const data = {
        title: document.getElementById('title').value,
        summary: document.getElementById('summary').value,
        cover: document.getElementById('cover')?.value || '',
        content: editor.value
    };
    
    const res = await fetch('/admin/posts', {
        method: 'POST',
        headers: { 
            'Content-Type': 'application/json', 
            'Authorization': token 
        },
        body: JSON.stringify(data)
    });
}
```

### å‰ç«¯ - åŠ¨æ€åŠ è½½ (blog-posts.js)

```javascript
// ä» API è·å–æ–‡ç« åˆ—è¡¨
async function loadPosts() {
    const response = await fetch('http://localhost:8080/posts');
    const posts = await response.json();
    
    posts.forEach(post => {
        const card = createArticleCard(post);
        articleList.prepend(card);  // æ’å…¥åˆ°æœ€å‰é¢
    });
}

// åˆ›å»ºæ–‡ç« å¡ç‰‡
function createArticleCard(post) {
    const mdPath = `../../comments/md/${post.id}-${safeTitle}.md`;
    const cover = post.cover || getRandomCover();
    
    return `
        <div class="article-card" data-md="${mdPath}">
            <div class="article-info">
                <h2 class="article-title">${post.title}</h2>
                <p class="article-excerpt">${post.summary}</p>
                <span class="article-date">${date}</span>
            </div>
            <div class="article-cover">
                <img src="${cover}" alt="${post.title}">
            </div>
        </div>
    `;
}
```

---

## MD æ–‡ä»¶æ ¼å¼

å‘å¸ƒåç”Ÿæˆçš„ Markdown æ–‡ä»¶æ ¼å¼ï¼š

```markdown
---
title: æ–‡ç« æ ‡é¢˜
date: 2025-12-10 15:30:00
tags: [æ ‡ç­¾1, æ ‡ç­¾2]
summary: æ–‡ç« æ‘˜è¦
cover: ../images/picture/blog/b1.jpeg
---

è¿™é‡Œæ˜¯æ–‡ç« æ­£æ–‡...
```

---

## å°é¢å›¾è®¾ç½®

### æ–¹å¼ä¸€ï¼šæŒ‡å®šå°é¢å›¾ URL

åœ¨å†™ä½œé¡µé¢å¡«å†™å°é¢å›¾ URLï¼Œæ”¯æŒï¼š
- ç›¸å¯¹è·¯å¾„ï¼š`../images/picture/blog/b1.jpeg`
- ç»å¯¹è·¯å¾„ï¼š`/static/images/picture/blog/b1.jpeg`
- å¤–éƒ¨é“¾æ¥ï¼š`https://example.com/image.jpg`

### æ–¹å¼äºŒï¼šè‡ªåŠ¨éšæœºåˆ†é…

ä¸å¡«å°é¢å›¾æ—¶ï¼Œä¼šä»ä»¥ä¸‹å›¾ç‰‡ä¸­éšæœºé€‰æ‹©ï¼š
- `../images/picture/blog/b1.jpeg`
- `../images/picture/blog/b2.jpg`
- `../images/picture/blog/b3.jpg`
- `../images/picture/ä½œä¸ºè°¢ç¤¼çš„å†°æ·‡æ·‹-åˆéŸ³æœªæ¥1_0001.jpg`

---

## æ•°æ®æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç®¡ç†å‘˜åœ¨ write.html å†™ä½œ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ ç‚¹å‡»å‘å¸ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. å‰ç«¯å‘é€ POST /admin/posts                              â”‚
â”‚     { title, summary, cover, content }                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åç«¯å¤„ç†ï¼š                                              â”‚
â”‚     â‘  ä¿å­˜åˆ° SQLite æ•°æ®åº“                                  â”‚
â”‚     â‘¡ ç”Ÿæˆ comments/md/1-æ ‡é¢˜.md æ–‡ä»¶                       â”‚
â”‚     â‘¢ è¿”å› { message: "å‘å¸ƒæˆåŠŸ", data: {...} }            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ç”¨æˆ·è®¿é—® blog.html                                      â”‚
â”‚     â‘  blog-posts.js è¯·æ±‚ GET /posts                        â”‚
â”‚     â‘¡ åŠ¨æ€ç”Ÿæˆæ–‡ç« å¡ç‰‡ï¼Œæ’å…¥é¡µé¢                             â”‚
â”‚     â‘¢ ç‚¹å‡»å¡ç‰‡å±•å¼€ï¼ŒåŠ è½½ comments/md/*.md æ–‡ä»¶              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ³¨æ„äº‹é¡¹

1. **åç«¯å¿…é¡»è¿è¡Œ**ï¼šåŠ¨æ€æ–‡ç« åŠ è½½ä¾èµ–åç«¯ API
2. **é™æ€æ–‡ç« å¤‡ç”¨**ï¼šåç«¯ä¸è¿è¡Œæ—¶ï¼Œé¡µé¢ä¸Šçš„é™æ€æ–‡ç« ä»å¯æ˜¾ç¤º
3. **æ–‡ä»¶å‘½åè§„åˆ™**ï¼š`{ID}-{æ ‡é¢˜}.md`ï¼Œæ ‡é¢˜ä¸­çš„ `/` å’Œç©ºæ ¼ä¼šæ›¿æ¢ä¸º `-`
4. **æ•°æ®åº“è¿ç§»**ï¼šæ·»åŠ  `cover` å­—æ®µåï¼Œéœ€è¦é‡å¯åç«¯è®© GORM è‡ªåŠ¨è¿ç§»

---

## å¸¸è§é—®é¢˜

### Q: å‘å¸ƒåçœ‹ä¸åˆ°æ–°æ–‡ç« ï¼Ÿ
A: æ£€æŸ¥ï¼š
1. åç«¯æ˜¯å¦è¿è¡Œä¸­
2. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. åˆ·æ–°é¡µé¢

### Q: æ–‡ç« å†…å®¹åŠ è½½å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥ï¼š
1. MD æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ–‡ä»¶æ˜¯å¦å­˜åœ¨äº `comments/md/` ç›®å½•

### Q: å°é¢å›¾ä¸æ˜¾ç¤ºï¼Ÿ
A: æ£€æŸ¥å°é¢å›¾ URL æ˜¯å¦æ­£ç¡®ï¼Œå›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨
