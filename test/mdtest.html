<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡å®šè·¯å¾„æ¸²æŸ“ Markdown</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.0/github-markdown-light.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

    <style>
        body {
            background-color: #f6f8fa;
            padding: 30px;
        }
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        /* åŠ è½½ä¸­çš„æç¤ºæ ·å¼ */
        #loading {
            text-align: center;
            color: #666;
            margin-top: 50px;
            font-size: 18px;
        }
        /* é”™è¯¯ä¿¡æ¯çš„æ ·å¼ */
        .error-msg {
            color: #cf222e;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="content" class="markdown-body">
    <div id="loading">æ­£åœ¨åŠ è½½æ–‡ç« ... (âˆ ãƒ»Ï‰< )âŒ’â˜…</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<script>
    // ================= é…ç½®åŒºåŸŸ =================
    // ğŸ‘‡ åœ¨è¿™é‡Œä¿®æ”¹ä½ çš„ md æ–‡ä»¶è·¯å¾„ (ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„)
    const mdFilePath = '../README.md';
    // ===========================================

    const contentDiv = document.getElementById('content');

    // ä½¿ç”¨ fetch è·å–æ–‡ä»¶å†…å®¹
    fetch(mdFilePath)
        .then(response => {
            // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            if (!response.ok) {
                throw new Error(`æ— æ³•åŠ è½½æ–‡ä»¶: ${mdFilePath} (çŠ¶æ€ç : ${response.status})`);
            }
            return response.text();
        })
        .then(markdownText => {
            // 1. è§£æ Markdown
            const dirtyHtml = marked.parse(markdownText);

            // 2. æ¸…æ´— HTML (é˜²XSS)
            const cleanHtml = DOMPurify.sanitize(dirtyHtml);

            // 3. æ¸²æŸ“åˆ°é¡µé¢
            contentDiv.innerHTML = cleanHtml;

            // 4. ä»£ç é«˜äº®
            contentDiv.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        })
        .catch(error => {
            // å¤„ç†é”™è¯¯ï¼ˆæ¯”å¦‚è·¯å¾„å†™é”™äº†ï¼Œæˆ–è€…æ²¡å¼€æœåŠ¡å™¨ï¼‰
            console.error('åŠ è½½å¤±è´¥:', error);
            contentDiv.innerHTML = `
                    <div class="error-msg">
                        åŠ è½½å¤±è´¥äº† QAQ<br>
                        ${error.message}<br><br>
                        <small>æç¤ºï¼šè¯·ç¡®ä¿ä½ ä½¿ç”¨äº† HTTP æœåŠ¡å™¨è¿è¡Œæ­¤é¡µé¢ (å¦‚ Live Server)ï¼Œè€Œä¸æ˜¯ç›´æ¥åŒå‡»æ‰“å¼€ã€‚</small>
                    </div>
                `;
        });
</script>
</body>
</html>